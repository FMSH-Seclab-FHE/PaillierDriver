//
// Created by douwei lei on 2025-June-16.
//

#include <gmp.h>
#include <stdio.h>
#include "test__fmsh_paillierDriver.h"

#define DATA_LEN (CORE_NUMBER * CLUSTER_NUMBER * 2) 

int main(void){
    int i, j, fpga2Host, fd, rc;
    unsigned char bytes_buffer_fromFpga[256 * ALL_BYTES_LEN_ENC_NCRT];
    const char* hs = "168B20666B14624438754D8BC15EC0C8B1D34489C771EE960BE5AA528C65F3C8B51EDA736E83068079508696D12C3FD71EBFEED43D4387034227A52E8B5B6EA982A8061F0DF15592A90E9479A802BA59C0B3644EE6ED242A687621BC2C565591732ECD36AE2329841F602F7031EBEDF295A1525E3FD9D0419F3D84BA580268AB9AAB903DF9FB924AF9059A19122F4A7731AF88AEC85CEEF1A8DEE57C2A183F0FBD52496D90EAB7E4F10C8A8E2582969882ABA824A78DCD99178B1B0A6420FA4375D4709A6DA274A7DCA323F6D247A963F90BC0BC3EE3BD216AD0FB58A08ED1E30EE936FB9FA681BE14BBC8647AD768BCDE37D7DD4981AC899F153FDC8C2760A840F65E2CA018DB3F9AD00201E66560EBDE00FBCB66689D91670C133C6848665DB07BC6FC03FBD58ABE1C26077DAB61C35E6EACCD7228F60F073FBD93C5F9B603BCFB0BBF92039A709ADF1905E5087313A7E7B77351BF1E8E7C0200F13A3A4043B9BFF248EBC2178DD32EEE7BDB0F7116D658C7962DA2819D46FC351F04219A6AE139012D94280F7EA9DF2E6A4BA07484118C4A856C1629426609B27BE4C601EDAD8CE4BBCC082FEB81478814C797F2CFB0AF0350D7F129A7939E622BBB0D7BD2DAE43BAE7BDA56EC433DC3C8D0410473599FAC4342D9616C07A28F3DCD313B734E1A379B3BB2ED3D263B32B3AC64E40A43C542BBC7A8538285621356338CFDAB";
    const char* n =  "AABC63F8BAD1AEAA338702B02FD1BAE8B3745855E741D20DDFD1AB1D32499D90E9726DBFEFC1DE64DBD66EF6A2AE3BF577936EF435EE2281D84C4BC60868814518F94290635B78450E49879E051636D4D05C9215F708DA6C8203095F54E48472BF170B9403616901E52A473A77E1E73F8FB204490A1A859D56F9A7AAC4EBC9F17DC755B635A6BA91AB9C84E69AB51420965DABF906FF291CFE620BB0C8AE690DA1AE4044FC601C1601B8F5CD3D1E44466696D3FBA8DF61FC9C326EEC46080FCA3D58863A16EB62CE31EADBC747094F298538CB9AEFCF7A8E089E9ABA0C8312FCBECB52C7E5E9CDF7BA2451F4086E32C480AB0CA5C0576D0587A42BFCBE58151D";
    const char* p =  "BED2589927341E276E19D6EE84FC938D440139B6ECCF399710959E99C206D9B75BADD3EA9652094056B6F24BB87F8EE391E47AACB7C64FDAFD395EE5D8D56D5A6855BADC2F3E1C8ADA93FB2660EC581934DF5639215B59AA614AC8CC85EEC2F8994F6B13A82D9D1D0B691BD564668FDB844EAAEA2BD3706CC4CBC696D96FC45F";
    const char* q =  "E50DB92F40D608DE2E838DADE4FF5AB7CA7716649F1462531387AB427CD8E2F0989613111F31536B9CD03DA020CA7BEF92E7CD45871F2AEBAA0FDD3DAB3C1A5E74C45679029E5A245A27830A7E2C490DD14D06BA2A55B93FCF6906328651FA6A14F42011B28070532179D4AB54396C45F9186391914BC478544E9450796C3803";

    gmp_randstate_t grt;
    gmp_randinit_default (grt);
    //paillier_InitWindowsPath(n, hs);
    //test_paillier_windowsPath();
    //test_paillier_enc_ncrt_final(grt, DATA_LEN, n, hs);
    //test_paillier_dec_crt_final (grt, DATA_LEN, p, q, n, hs);
    test_paillier_scale_mul_final(grt, DATA_LEN, n, hs);

    // fpga2Host = open_fpga2HostChannel(1);
    // if(fpga2Host == -1){
    //     printf("[Error] paillier_InitWindowsPath: Device open error\n");
    //     return;
    // }
    // fd = open("/home/zhangchi/paillier_prj_manyVersions/driver/PaillierDriver/data/my_hsW.bin", O_RDWR | O_CREAT | O_APPEND, 0644);
    // if(fd == -1){
    //     printf("[Error] paillier_InitWindowsPath: fd open error\n");
    //     return;
    // }
    // for(i = 0; i < WINDOWS_NUM; i++){
    //     rc = read_from_fpga_to_host(fpga2Host, ((uint64_t)DDR1_ADDR + ((uint64_t)i * 256ULL * ALL_BYTES_LEN_ENC_NCRT)), bytes_buffer_fromFpga, 256 * ALL_BYTES_LEN_ENC_NCRT);
    //     if(rc == -1) { 
    //         printf("write core bram_addr wrong\n\n");
    //     }
    //     write(fd, bytes_buffer_fromFpga, 256 * ALL_BYTES_LEN_ENC_NCRT);
    // }
}

